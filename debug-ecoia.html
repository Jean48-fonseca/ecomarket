<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç EcoIA Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test-case { background: #f5f5f5; margin: 10px 0; padding: 15px; border-radius: 8px; }
        .input { background: #e3f2fd; padding: 10px; margin: 5px 0; }
        .output { background: #e8f5e8; padding: 10px; margin: 5px 0; }
        .error { background: #ffebee; padding: 10px; margin: 5px 0; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        textarea { width: 100%; height: 100px; }
    </style>
</head>
<body>
    <h1>üîç EcoIA Debug Test - Ver qu√© detecta</h1>
    
    <div>
        <h3>Prueba manual:</h3>
        <textarea id="customInput" placeholder="Escribe tu pregunta aqu√≠..."></textarea>
        <br>
        <button onclick="testCustom()">Probar Pregunta</button>
    </div>
    
    <div>
        <h3>Tests autom√°ticos:</h3>
        <button onclick="runAllTests()">Ejecutar Todos los Tests</button>
        <div id="results"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000'; // Cambiar por Render cuando funcione
        
        const testCases = [
            { input: "hola", expected: "conversacion_general" },
            { input: "como estas", expected: "conversacion_general" },
            { input: "que productos tienes", expected: "conversacion_general" },
            { input: "receta de sushi", expected: "receta_sushi" },
            { input: "como hacer pasta", expected: "receta_pasta" },
            { input: "preparar ceviche", expected: "receta_ceviche" },
            { input: "cuanto cuesta el tomate", expected: "precios" },
            { input: "que beneficios tienen los productos organicos", expected: "ecologia" },
            { input: "donde encuentro proteinas", expected: "nutricion" },
            { input: "solo frutas", expected: "conversacion_general" }, // Este NO debe dar smoothie
        ];
        
        async function testEcoIA(input) {
            try {
                const response = await fetch(`${API_URL}/ecoia`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ pregunta: input })
                });
                
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                return data.respuesta;
            } catch (error) {
                return `ERROR: ${error.message}`;
            }
        }
        
        function analyzeResponse(response) {
            if (response.includes('ERROR:')) return 'error';
            if (response.includes('Sushi')) return 'receta_sushi';
            if (response.includes('Pasta')) return 'receta_pasta';
            if (response.includes('Ceviche')) return 'receta_ceviche';
            if (response.includes('Smoothie')) return 'receta_smoothie';
            if (response.includes('precio') || response.includes('costo')) return 'precios';
            if (response.includes('org√°nico') || response.includes('ecol√≥gico')) return 'ecologia';
            if (response.includes('prote√≠na') || response.includes('vitamina')) return 'nutricion';
            return 'conversacion_general';
        }
        
        async function testCustom() {
            const input = document.getElementById('customInput').value.trim();
            if (!input) return;
            
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>‚è≥ Probando pregunta personalizada...</p>';
            
            const response = await testEcoIA(input);
            const detected = analyzeResponse(response);
            
            resultsDiv.innerHTML = `
                <div class="test-case">
                    <div class="input"><strong>Pregunta:</strong> "${input}"</div>
                    <div class="output"><strong>Detectado como:</strong> ${detected}</div>
                    <div class="output"><strong>Respuesta:</strong> ${response.substring(0, 200)}...</div>
                </div>
            `;
        }
        
        async function runAllTests() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>‚è≥ Ejecutando tests...</p>';
            
            let html = '<h3>Resultados de los Tests:</h3>';
            
            for (const testCase of testCases) {
                const response = await testEcoIA(testCase.input);
                const detected = analyzeResponse(response);
                const isCorrect = detected === testCase.expected;
                
                html += `
                    <div class="test-case">
                        <div class="input"><strong>Input:</strong> "${testCase.input}"</div>
                        <div class="output"><strong>Esperado:</strong> ${testCase.expected}</div>
                        <div class="output"><strong>Detectado:</strong> ${detected}</div>
                        <div class="${isCorrect ? 'output' : 'error'}">
                            <strong>Resultado:</strong> ${isCorrect ? '‚úÖ CORRECTO' : '‚ùå INCORRECTO'}
                        </div>
                        <div class="output"><strong>Respuesta:</strong> ${response.substring(0, 150)}...</div>
                    </div>
                `;
                
                // Peque√±o delay para no sobrecargar
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            resultsDiv.innerHTML = html;
        }
        
        // Info inicial
        document.getElementById('results').innerHTML = `
            <p><strong>üìã Instrucciones:</strong></p>
            <ul>
                <li>‚úÖ <strong>CORRECTO:</strong> Solo da recetas cuando pides "receta de..." o "como hacer..."</li>
                <li>‚ùå <strong>INCORRECTO:</strong> Da smoothie cuando dices solo "frutas"</li>
                <li>üîç <strong>Debug:</strong> Revisa la consola del navegador para ver los logs</li>
            </ul>
            <p><strong>‚ö†Ô∏è Aseg√∫rate de que el servidor est√© corriendo en http://localhost:3000</strong></p>
        `;
    </script>
</body>
</html>